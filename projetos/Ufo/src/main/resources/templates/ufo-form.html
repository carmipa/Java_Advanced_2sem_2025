<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title th:text="${ufo.id} != null ? 'Editar avistamento' : 'Novo avistamento'">Novo avistamento</title>
  <!-- DEV/CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet">
</head>
<body class="min-h-screen bg-base-200">
<header class="navbar bg-base-100 shadow">
  <div class="navbar-start">
    <a th:href="@{/ufos}" class="btn btn-ghost normal-case text-xl">UFO Tracker</a>
  </div>
</header>

<main class="container mx-auto p-4">
  <div class="card bg-base-100 shadow-xl max-w-2xl mx-auto">
    <div class="card-body">
      <h2 class="card-title" th:text="${ufo.id} != null ? 'Editar avistamento' : 'Novo avistamento'">Novo avistamento</h2>

      <form th:action="${ufo.id} != null ? @{'/ufos/' + ${ufo.id}} : @{/ufos}"
            th:object="${ufo}"
            method="post"
            class="grid grid-cols-1 gap-4">

        <!-- Em edição: emule PUT -->
        <input type="hidden" name="_method" value="put" th:if="${ufo.id} != null"/>

        <!-- Local -->
        <label class="form-control">
          <span class="label"><span class="label-text">Local</span></span>
          <input type="text" th:field="*{location}" placeholder="Cidade/Estado"
                 class="input input-bordered" required/>
          <span class="label text-error text-xs" th:if="${#fields.hasErrors('location')}"
                th:errors="*{location}">Erro</span>
        </label>

        <!-- Data do avistamento -->
        <label class="form-control">
          <span class="label"><span class="label-text">Data do avistamento</span></span>
          <input type="date" th:field="*{sightingDate}" class="input input-bordered" required/>
          <span class="label text-error text-xs" th:if="${#fields.hasErrors('sightingDate')}"
                th:errors="*{sightingDate}">Erro</span>
        </label>

        <!-- Cor -->
        <label class="form-control">
          <span class="label"><span class="label-text">Cor</span></span>
          <input type="text" th:field="*{color}" placeholder="Ex.: Verde, Vermelho"
                 class="input input-bordered"/>
          <span class="label text-error text-xs" th:if="${#fields.hasErrors('color')}"
                th:errors="*{color}">Erro</span>
        </label>

        <!-- Forma (Enum) -->
        <label class="form-control">
          <span class="label"><span class="label-text">Forma</span></span>
          <select th:field="*{shape}" class="select select-bordered" required>
            <option th:each="s : ${T(br.com.fiap.ufo.model.UfoShape).values()}"
                    th:value="${s}"
                    th:text="${s}">DISCO</option>
          </select>
          <span class="label text-error text-xs" th:if="${#fields.hasErrors('shape')}"
                th:errors="*{shape}">Erro</span>
        </label>

        <!-- Quantidade de objetos -->
        <label class="form-control">
          <div class="flex items-center justify-between">
            <span class="label-text">Quantidade de objetos</span>
            <p id="qty-label" class="text-xs opacity-70"
               th:text="(((*{quantityObjects}) != null ? *{quantityObjects} : 1)) + ' objeto(s)'">
              1 objeto(s)
            </p>
          </div>

          <input id="quantityObjects"
                 type="range" min="1" max="20" step="1"
                 th:field="*{quantityObjects}"
                 class="range"/>

          <div class="flex justify-between text-xs px-1 opacity-70">
            <span>1</span><span>5</span><span>10</span><span>15</span><span>20</span>
          </div>

          <span class="label text-error text-xs" th:if="${#fields.hasErrors('quantityObjects')}"
                th:errors="*{quantityObjects}">Erro</span>
        </label>

        <div class="card-actions justify-end pt-2">
          <a th:href="@{/ufos}" class="btn btn-ghost">Cancelar</a>
          <button type="submit" class="btn btn-primary">Salvar</button>
        </div>
      </form>
    </div>
  </div>
</main>


<script>
  (function () {
    const input = document.getElementById('quantityObjects');
    const label = document.getElementById('qty-label');
    if (input && label) {
      const update = () => label.textContent = input.value + ' objeto(s)';
      input.addEventListener('input', update);
      update(); // inicial
    }
  })();
</script>
</body>
</html>
